<mat-card class="form_cards PropertiesForm">
  <mat-toolbar
    class="mat-toolbar_all mat-toolbar details-toolbar mat-toolbar-single-row " [class.activeID]="isActivePd">
    <mat-card-title class="sidebar_form_title matCardTitles">
      {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.heading.datasource.scripting'): ""}} <small *ngIf="isActivePdSmall">{{datasourceTitleName}}</small>
    </mat-card-title>
  </mat-toolbar>
  <div class="mat-content">
    <mat-tab-group animationDuration="0ms">
      <mat-tab label="Properties">
        <div  *ngFor="let error of dataSourceError" [hidden]="!messageError">
          <mat-card class="validation-error">
            <li>{{error.property}}
              : {{error.message}}</li>
          </mat-card>
        </div>
 <div class="">
          <mat-form-field class="datapoint_field dataSourceAllInputs w-50 mt-10" appearance="fill">
            <mat-label> {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.exportId'): ""}}</mat-label>
            <input class="w-50" matInput [(ngModel)]="scriptingDatasource.xid"
                   name="xid" type="text" class="datasourceBoxHeight" required readonly placeholder="Autogenerated">
          </mat-form-field>
          <mat-form-field class="datapoint_field dataSourceAllInputs w-50" appearance="fill">
            <mat-label>
              {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.name'): ""}}
            </mat-label>
            <input class="w-50" matInput name="name" type="text" [(ngModel)]="scriptingDatasource.name">
          </mat-form-field>

        <div>
          <mat-form-field class="datapoint_field dataSourceAllInputs w-50" appearance="fill">
            <mat-label>
              {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.fields.readPermission'): ""}}
            </mat-label>
            <mat-select  name="editPermission" [(ngModel)]="editPermission" multiple>
              <mat-option *ngFor="let read of readPermission" [value]="read">{{read}}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field class="datapoint_field dataSourceAllInputs w-50" appearance="fill">
            <mat-label>{{UIDICTIONARY ? UIDICTIONARY.get('ui.core.heading.globalScripts').substring(6,13): ""}} {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.permissions'): ""}}</mat-label>
            <mat-select name="scriptPermission" [(ngModel)]="scriptPermission" multiple>
              <mat-option *ngFor="let write of readPermission" [value]="write">{{write}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <mat-divider class="dividerAllCommonFields"></mat-divider>
        <div>
          <mat-form-field class="datapoint_field dataSourceAllInputs w-50 mt-10" appearance="fill">
            <mat-label>{{UIDICTIONARY ? UIDICTIONARY.get('ui.core.publisher.placeHolder.updateEvents'): ""}}</mat-label>
            <mat-select class="form-control" name="updateEvent" [(ngModel)]="scriptingDatasource.updateEvent">
              <mat-option *ngFor="let context of (updateEvents | keyvalue).slice(0 ,3)"
                          [value]="context.value">{{ context.value }}</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field class="datapoint_field dataSourceAllInputs w-50" appearance="fill">
            <mat-label>
              {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.executionDelaySeconds'): ""}}
            </mat-label>
            <input matInput name="Execution Delays" type="text" [(ngModel)]="scriptingDatasource.executionDelaySeconds"
                   name="Execution Delay Seconds" type="text">
          </mat-form-field>
        </div>
        <div>
            <textarea  autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" id="terminal" cols="100" rows="100" class="globalScript scriptingValidate terminal" [(ngModel)]="scriptingDatasource.script"
                      name="script"></textarea>
          </div>
        <mat-error class="errorAllMSG"><div  *ngFor="let error of scriptError" [hidden]="!messageError">
          <mat-card class="validation-error" [class.activeIDColor]="isActiveColor">
            <li>{{error.property}}
              : {{error.message}}</li>
          </mat-card>
        </div></mat-error>
        <div>

          <button mat-raised-button (click)="validateScript()" class="validateButton">{{"Validate"}}</button>
          <mat-divider></mat-divider>

        </div>
        <div>
          <mat-form-field class="form_field modbusInputField marginTop datapointSelectItem" appearance="fill">
            <mat-label>{{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.select'): ""}} {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.button.viewSelectedItems').substring(13,19): ""}}</mat-label>
            <mat-select [formControl]="selectedItemsControl" multiple [(ngModel)]="selectedItems"
                        (selectionChange)="onSelectionChange($event)">
              <mat-select-trigger>{{ selectedItems.length }} item(s) selected</mat-select-trigger>
              <input class="datapoint_field dataSourceAllInputs w-50 datapointPaddingSearch" appearance="fill"
                     matInput
                     placeholder="Search items..."
                     (keyup)="dataPointLists($event)"
                     [formControl]="searchControl"
              />

              <mat-option
                *ngFor="let item of filteredItemListing"
                [value]="item.xid"
                [title]="item.extendedName"
                [disabled]="isSelected(item.xid)"
              >
                {{ item.extendedName }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <button [disabled]="!buttonViews"   (click)="viewSelectedItems()" mat-raised-button color="primary"
                  class="viewButton">{{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.button.viewSelectedItems'): ""}}</button>
        </div>
        <div>
          <mat-form-field class="form_field  w-50" appearance="fill">
            <mat-label>
              {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.logSize'): ""}}
            </mat-label>
            <input matInput name="Execution Delays" type="text" [(ngModel)]="scriptingDatasource.logSize">
          </mat-form-field>
          <mat-form-field class="form_field  w-50 marginLeft-20" appearance="fill">
            <mat-label>
              {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.logCount'): ""}}
            </mat-label>
            <input matInput name="Execution Delays" type="text" [(ngModel)]="scriptingDatasource.logCount">
          </mat-form-field>

        </div>
        <div>
          <mat-form-field class="form_field modbusInputField marginTop w-50" appearance="fill">
            <mat-label>{{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.logLevel'): ""}}</mat-label>
            <mat-select class="form-control" name="logLevel" [(ngModel)]="scriptingDatasource.logLevel">
              <mat-option *ngFor="let log of (logLevels | keyvalue).slice(0, 7)"
                          [value]="log.value">{{ log.value }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-slide-toggle name="polling" [(ngModel)]="scriptingDatasource.polling"
                            (change)="onPollingChange($event.checked)"
                            class="side_form_toggle toggle_change allToggls form_field modbusInputField marginTop">
            {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.snmp.polling'): ""}}
          </mat-slide-toggle>
        </div>
        <div>
          <mat-form-field class="form_field modbusInputField marginTop w-50" appearance="fill" *ngIf="scriptingDatasource.polling===true">
            <mat-label>
              {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.modbusControllerSlaveDevice.fields.pollingInterval'): ""}}
            </mat-label>
            <input matInput class="form_field" name="timePeriod"
                   [(ngModel)]="scriptingDatasource.timePeriod.timePeriod"
                   type="text" required>
          </mat-form-field>
          <mat-form-field class="form_field w-50" appearance="fill" *ngIf="scriptingDatasource.polling===true">
            <mat-label>
              {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.modbusControllerSlaveDevice.fields.pollingInterval'): ""}} {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.dataPoint.textRender.type'): ""}}
            </mat-label>
            <mat-select class="form-control"
                        name="timePeriodType" [(ngModel)]="scriptingDatasource.timePeriod.timePeriodType">
              <mat-option *ngFor="let timeperiod of timePeriods" [value]="timeperiod.value">{{timeperiod.key}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          </div>
        </div>

          <mat-slide-toggle name="quantize" [(ngModel)]="scriptingDatasource.quantize" *ngIf="scriptingDatasource.polling===true"
                            class="side_form_toggle toggle_change allToggls form_field modbusInputField marginTop">
            {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.quantize'): ""}}
          </mat-slide-toggle>

        <br>

        
          <button #updateButton matfab class="updateButton saveButton" (click)="updateDatasource()"
                  *ngIf="datasourceIsEdit">
                   <mat-icon>save_as</mat-icon>
                  {{UIDICTIONARY ? (UIDICTIONARY.get('ui.core.common.button.update') | uppercase) : ""}}</button>
          <button #saveButton matfab class="saveButton" (click)="saveDatasource()"
                  *ngIf="!datasourceIsEdit">
                   <mat-icon>save</mat-icon>
                  {{UIDICTIONARY ? (UIDICTIONARY.get('ui.core.common.button.save') |  uppercase) : ""}}</button>

      </mat-tab>

      <mat-tab label="Points" *ngIf="datapointForm">
        <div class="sidebar-form dataPointTabs" [hidden]="!displayForm">
          <!--          [hidden]="!dataPointHide"-->
          <div>
            <p>
              <mat-form-field class="datapoint_field dataSourceAllInputs w-50" appearance="fill">
                <mat-label> {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.exportId'): ""}}</mat-label>
                <input readonly matInput [(ngModel)]="dataPointModel.xid"
                       name="xid" placeholder="xid" class="datasourceBoxHeight">
              </mat-form-field>
              <mat-form-field class="datapoint_field dataSourceAllInputs w-50" appearance="fill">
                <mat-label>{{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.name'): ""}}</mat-label>
                <input matInput [(ngModel)]="dataPointModel.name"
                       name="name" type="text" required placeholder="Name">
              </mat-form-field>
            </p>
            <p>
              <mat-form-field class="datapoint_field dataSourceAllInputs w-50" appearance="fill">
                <mat-label>
                  {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.fields.readPermission'): ""}}
                </mat-label>
                <mat-select name="editPermission" [(ngModel)]="editPermission" multiple>
                  <mat-option *ngFor="let read of readPermission" [value]="read">{{read}}</mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field class="datapoint_field dataSourceAllInputs w-50" appearance="fill">
                <mat-label>{{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.fields.dataType'): ""}}</mat-label>
                <mat-select name="dataType" [(ngModel)]="scriptingPointLocateModel.dataType">
                  <mat-option *ngFor="let data of dataTypes" [value]="data.key">{{data.value}}</mat-option>
                </mat-select>
              </mat-form-field>
            </p>
            <p>
              <mat-form-field class="datapoint_field dataSourceAllInputs w-50" appearance="fill">
                <mat-label>{{UIDICTIONARY ? UIDICTIONARY.get('ui.core.snmp.cols.variableSyntax').substring(0, 8): ""}} {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.snmp.oids.sysName'): ""}}</mat-label>
                <input matInput
                       type="text" [(ngModel)]="scriptingPointLocateModel.varName" name="varName" required>
              </mat-form-field>
              <mat-slide-toggle name="contextUpdate" [(ngModel)]="scriptingPointLocateModel.contextUpdate"
                                class="side_form_toggle toggle_change allToggls form_field modbusInputField marginTop">
                {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.contextUpdate'): ""}}
              </mat-slide-toggle>
            </p>
            <div class="meshActionsButtons">
              <div *ngIf="!datapointButtonsView then savePoint else updatePoint"></div>
              <ng-template #savePoint>
                <button matfab class="allDataPointSaveButton saveButton" (click)="saveDataPoint()">
                   <mat-icon>save</mat-icon>
                  {{UIDICTIONARY ? (UIDICTIONARY.get('ui.core.common.button.save') |  uppercase) : ""}}</button>
              </ng-template>
              <ng-template #updatePoint>
                <button matfab class="Update_Button saveButton" (click)="updateDataPoint()">
                   <mat-icon>save_as</mat-icon>
                  {{UIDICTIONARY ? (UIDICTIONARY.get('ui.core.common.button.update') | uppercase) : ""}}
                </button>
              </ng-template>
            </div>
            <button mat-raised-button (click)="cancelDataPoint()"
                    class="cancel_button_new cancelPoint">{{UIDICTIONARY ? (UIDICTIONARY.get('ui.core.common.button.cancel') | uppercase) : ""}}</button>

          </div>

        </div>
        <mat-divider class="dividerBorder"></mat-divider>
        <app-datapoint-table (editPoint)="editDataPoint($event)" (addPoint)="addNewDatapoint($event, 1)">
        </app-datapoint-table>
      </mat-tab>
    </mat-tab-group>
  </div>
</mat-card>


