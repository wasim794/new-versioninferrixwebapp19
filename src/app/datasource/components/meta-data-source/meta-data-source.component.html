<mat-card class="form_cards metaDataSources commonMatCardDataSource">
  <mat-toolbar
    class="mat-toolbar_all mat-toolbar details-toolbar mat-toolbar-single-row" [class.activeID]="isActivePd">
    <mat-card-title class="sidebar_form_title matCardTitles">
      {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.heading.datasource.metaDSNode'): ""}} <small *ngIf="isActivePdSmall">{{datasourceTitleName}}</small>
    </mat-card-title>
    <mat-icon class="helpInformation" (click)="metaScriptHelp()"> <i class="material-icons">help_outline</i></mat-icon>
  </mat-toolbar>
  <div class="mat-content allSensors">
    <mat-tab-group animationDuration="0ms" [selectedIndex]="tabIndex">
      <mat-tab label="Properties">
        <div  *ngFor="let error of dataSourceError" [hidden]="!messageError">
          <mat-card class="validation-error">
            <li>{{error.property}}
              : {{error.message}}</li>
          </mat-card>
        </div>
        <p>
          <mat-form-field class="formCommonFieldWidth" appearance="fill">
            <mat-label>
              {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.name'): ""}}
            </mat-label>
            <input matInput name="name" [(ngModel)]="metaDatasourceModel.name" type="text">
          </mat-form-field>
          <mat-form-field class="formCommonFieldWidth marginTop" appearance="fill">
            <mat-label> {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.exportId'): ""}}</mat-label>
            <input matInput
                   name="xid" [(ngModel)]="metaDatasourceModel.xid" type="text" required readonly placeholder="Autogenerated">
          </mat-form-field>
        </p>
        <p>
          <mat-form-field class="formCommonFieldWidth marginTop" appearance="fill">
            <mat-label disabled> {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.heading.permissions'): ""}}</mat-label>
            <mat-select name="editPermission" [(ngModel)]="editPermission" multiple>
              <mat-option *ngFor="let read of readPermission" [value]="read">{{read}}</mat-option>
            </mat-select>
          </mat-form-field>
        </p>
        <mat-divider class="dividerAllCommonFields"></mat-divider>
        <br>
        <p>
          <button #updateButton mat-raised-button class="updateButton"  (click)="updateDatasource()"  *ngIf="datasourceIsEdit">{{UIDICTIONARY ? (UIDICTIONARY.get('ui.core.common.button.update') | uppercase) : ""}}</button>
          <button #saveButton mat-raised-button class="saveButton"  (click)="saveDatasource()" *ngIf="!datasourceIsEdit" >{{UIDICTIONARY ? (UIDICTIONARY.get('ui.core.common.button.save') |  uppercase) : ""}}</button>
        </p>
      </mat-tab>
      <mat-tab label="Points" [disabled]="!dataPointHide" >
        <div class="sidebar-form dataPointTabs" *ngIf="datapointForm">
          <!--          [hidden]="!dataPointHide"-->
          <div >
            <p>
              <mat-form-field class="datapoint_field dataSourceAllInputs w-50" appearance="fill">
                <mat-label> {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.exportId'): ""}}</mat-label>
                <input readonly matInput [(ngModel)]="dataPointModel.xid"
                       name="xid" placeholder="xid" class="datasourceBoxHeight">
              </mat-form-field>
              <mat-form-field class="datapoint_field dataSourceAllInputs w-50" appearance="fill">
                <mat-label>{{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.name'): ""}}</mat-label>
                <input matInput [(ngModel)]="dataPointModel.name"
                       name="name" type="text" required placeholder="Name">
              </mat-form-field>
            </p>
            <p>
              <mat-form-field class="datapoint_field dataSourceAllInputs w-50" appearance="fill">
                <mat-label>
                  {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.fields.readPermission'): ""}}
                </mat-label>
                <mat-select name="editPermission" [(ngModel)]="editPermission" multiple>
                  <mat-option *ngFor="let read of readPermission" [value]="read">{{read}}</mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field class="datapoint_field dataSourceAllInputs w-50" appearance="fill">
                <mat-label>{{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.fields.writePermission'): ""}}</mat-label>
                <mat-select name="setPermission" [(ngModel)]="setPermission" multiple>
                  <mat-option *ngFor="let write of readPermission" [value]="write">{{write}}</mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field class="datapoint_field dataSourceAllInputs w-50" appearance="fill">
                <mat-label>{{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.fields.dataType'): ""}}</mat-label>
                <mat-select name="dataType" [(ngModel)]="metaPointLocatorModel.dataType">
                  <mat-option *ngFor="let data of dataTypes" [value]="data.key">{{data.value}}</mat-option>
                </mat-select>
              </mat-form-field>
            </p>
            <p>
              <mat-form-field class="datapoint_field dataSourceAllInputs w-50" appearance="fill">
                <mat-label>
                  {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.heading.globalScripts').substring(6, 13): ""}} {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.snmp.engineId').substring(0, 6): ""}}
                </mat-label>
                <mat-select name="scriptEngine" [(ngModel)]="metaPointLocatorModel.scriptEngine">
                  <mat-option *ngFor="let script of allScriptEngine" [value]="script.toUpperCase()">{{script}}</mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field class="datapoint_field dataSourceAllInputs w-50" appearance="fill">
                <mat-label>
                  {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.heading.globalScripts').substring(6, 13): ""}} {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.heading.permissions').substring(0, 11): ""}}
                </mat-label>
                <mat-select name="scriptPermission" [(ngModel)]="scriptPermission" multiple>
                  <mat-option *ngFor="let write of readPermission" [value]="write">{{write}}</mat-option>
                </mat-select>
              </mat-form-field>
            </p>
            <mat-form-field class="datapoint_field dataSourceAllInputs datapointSelectItem"  appearance="fill">
              <mat-label>
                {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.select'): ""}} {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.button.viewSelectedItems').substring(13, 20): ""}}
              </mat-label>
              <mat-select [formControl]="selectedItemsControl" multiple [(ngModel)]="selectedItems" (selectionChange)="onSelectionChange($event)">
                <mat-select-trigger>{{ selectedItems.length }} item(s) selected</mat-select-trigger>
                <input class="datapoint_field dataSourceAllInputs w-50 datapointPaddingSearch" appearance="fill"
                       matInput
                       placeholder="Search items..."  (keyup)="dataPointLists($event)"

                       [formControl]="searchControl"
                />
                <mat-option
                  *ngFor="let item of filteredItemListing"
                  [value]="item.xid"
                  (onSelectionChange)="onOptionSelectionChange($event, item)"
                  [disabled]="isSelected(item.xid)" [title]="item.extendedName"
                >
                  {{ item.extendedName }}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <div  class="ui borderless menu" style="display: none">
              <mat-paginator  [pageIndex]=0 [length]="totoalDatapoints" [pageSizeOptions]="pageSizeOptions" [pageSize]=limit
                              (page)="getNext($event)"></mat-paginator>
            </div>
            <button [disabled]="!buttonViews" style="line-height: 45px;" (click)="viewSelectedItems()" mat-raised-button color="primary"
                    class="viewButton">{{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.button.viewSelectedItems'): ""}}</button>
            <p >

              <mat-form-field class="globalScript" >
                <mat-label> </mat-label>
                <textarea matInput autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" id="terminal"  rows="10" class="terminal" [(ngModel)]="metaPointLocatorModel.script" name="script"></textarea>
              </mat-form-field>

            </p>
            <mat-error class="errorAllMSG"><div  *ngFor="let error of scriptError" [hidden]="!messageError">
              <mat-card class="validation-error" [class.activeIDColor]="isActiveColor">
                <li>{{error.property}}
                  : {{error.message}}</li>
              </mat-card>
            </div></mat-error>
            <button mat-raised-button (click)="Validates(metaPointLocatorModel.script)"  class="validateButton">{{"Validate"}}</button>

            <p>
              <mat-form-field class="ddatapoint_field dataSourceAllInputs w-50" appearance="fill">
                <mat-label>
                  {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.logLevel'): ""}}
                </mat-label>
                <mat-select [(ngModel)]="metaPointLocatorModel.logLevel" name="logLevel" >
                  <mat-option *ngFor="let item of (LogLevels | keyvalue).slice(0, 7)" [value]="item.value">{{item.value}}</mat-option>
                </mat-select>
              </mat-form-field>

            </p>
            <p>
              <mat-form-field class="ddatapoint_field dataSourceAllInputs w-50" appearance="fill">
                <mat-label>
                  {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.publisher.placeHolder.updateEvents'): ""}}
                </mat-label>
                <mat-select name="updateEvent"  [(ngModel)]="metaPointLocatorModel.updateEvent" (selectionChange)="onSelectionChangeT($event)">
                  <mat-option *ngFor="let event of updateEvent" [value]="event.value">{{event.key}}</mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field *ngIf="updateCornHide" class="datapoint_field dataSourceAllInputs w-50" appearance="fill">
                <mat-label>{{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.updateCronPattern'): ""}}</mat-label>
                <input matInput
                       [(ngModel)]="metaPointLocatorModel.updateCronPattern" type="text" required >
              </mat-form-field>

              <mat-form-field class="datapoint_field dataSourceAllInputs w-50" appearance="fill">
                <mat-label>
                  {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.snmp.cols.variableSyntax').substring(0, 8): ""}} {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.snmp.oids.sysName'): ""}}
                </mat-label>
                <input matInput
                       type="text"  [(ngModel)]="metaPointLocatorModel.variableName" name="variableName" required >
              </mat-form-field>
              <mat-form-field class="ddatapoint_field dataSourceAllInputs w-50" appearance="fill">
                <mat-label>
                  {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.executionDelaySeconds'): ""}}
                </mat-label>
                <input matInput
                       [(ngModel)]="metaPointLocatorModel.executionDelaySeconds" name="executionDelaySeconds" type="text" required >
              </mat-form-field>
              <mat-form-field class="ddatapoint_field dataSourceAllInputs w-50" appearance="fill">
                <mat-label>
                  {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.contextEventUpdate'): ""}}
                </mat-label>
                <mat-select [(ngModel)]="metaPointLocatorModel.contextUpdateEvent" name="logLevel" >
                  <mat-option *ngFor="let item of (contextUpdateEvents | keyvalue).slice(0, 3)" [value]="'CONTEXT_'+item.value">{{item.value}}</mat-option>
                </mat-select>
              </mat-form-field>
            </p>

            <p>
              <mat-form-field class="datapoint_field dataSourceAllInputs w-50" appearance="fill">
                <mat-label>{{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.logSize'): ""}}</mat-label>
                <input matInput
                       type="text" [(ngModel)]="metaPointLocatorModel.logSize" name="logSize" required >
              </mat-form-field>
              <mat-form-field class="ddatapoint_field dataSourceAllInputs w-50" appearance="fill">
                <mat-label>
                  {{UIDICTIONARY ? UIDICTIONARY.get('ui.core.common.placeholder.logCount'): ""}}
                </mat-label>
                <input matInput
                       [(ngModel)]="metaPointLocatorModel.logCount" name="logCount" type="text" required >
              </mat-form-field>
            </p>

            <div class="meshActionsButtons">
              <div *ngIf="!datapointButtonsView then savePoint else updatePoint"></div>
              <ng-template #savePoint>
                <button mat-raised-button class="allDataPointSaveButton mupdateButton" (click)="saveDataPoint()">
                  {{UIDICTIONARY ? (UIDICTIONARY.get('ui.core.common.button.save') |  uppercase) : ""}}</button>
              </ng-template>
              <ng-template #updatePoint>
                <button mat-raised-button class="Update_Button mupdateButton" (click)="updateDataPoint()">
                  {{UIDICTIONARY ? (UIDICTIONARY.get('ui.core.common.button.update') | uppercase) : ""}}
                </button>
              </ng-template>
            </div>
            <button mat-raised-button (click)="cancelDataPoint()" class="cancel_button_new cancelPoint marginLeft-88">{{UIDICTIONARY ? (UIDICTIONARY.get('ui.core.common.button.cancel') | uppercase) : ""}}</button>

          </div>
        </div>
        <mat-divider class="dividerBorder"></mat-divider>
        <app-datapoint-table (editPoint)="editDataPoint($event)" (addPoint)="addNewDatapoint($event, 1)">
        </app-datapoint-table>
      </mat-tab>
    </mat-tab-group>
  </div>
</mat-card>

